# بنية قاعدة البيانات المقترحة لنظام CurioGrid

## مقدمة

يقدم هذا المستند نظرة عامة مفصلة على بنية قاعدة البيانات المقترحة لتطبيق **CurioGrid**. تم تصميم هذا الهيكل ليكون قابلاً للتطوير وآمناً، ويهدف إلى دعم جميع الميزات الحالية والمستقبلية للتطبيق بفعالية، بما في ذلك إدارة المستخدمين، وتتبع الاستخدام، وحفظ المسودات، وإدارة الاشتراكات.

---

## نظرة عامة على الجداول (Collections)

نقترح بناء النظام حول أربع مجموعات أساسية (جداول)، وهي:

1.  **Users (المستخدمون):** لتخزين معلومات كل مستخدم مسجل في المنصة.
2.  **Drafts (المسودات):** لحفظ المحتوى الذي يتم إنشاؤه بواسطة الذكاء الاصطناعي كمسودات للمستخدمين.
3.  **Subscriptions (الاشتراكات):** لإدارة تفاصيل خطط اشتراك المستخدمين وحالتها.
4.  **Payments (المدفوعات):** لتسجيل سجلات عمليات الدفع وتفاصيلها.

---

## تفاصيل الجداول والأعمدة (Collections & Fields)

### 1. جدول `Users`

يحتوي هذا الجدول على ملفات تعريف المستخدمين الأساسية.

| اسم العمود (Field) | نوع البيانات (Data Type) | الوصف                                            | مثال                  |
| :------------------ | :------------------------ | :----------------------------------------------- | :--------------------- |
| **userId**          | `string`                  | **(المفتاح الأساسي)** مُعرّف فريد لكل مستخدم.   | `auth_user_123abc`     |
| **name**            | `string`                  | الاسم الكامل للمستخدم.                          | `'Alex'`               |
| **email**           | `string`                  | البريد الإلكتروني للمستخدم، ويجب أن يكون فريدًا. | `'alex@example.com'`   |
| **plan**            | `string`                  | نوع خطة الاشتراك الحالية (`Starter`, `Pro`, `Yearly`). | `'Pro'`                |
| **createdAt**       | `timestamp`               | تاريخ ووقت إنشاء حساب المستخدم.                 | `2023-10-27T10:00:00Z` |

#### تتبع الاستخدام (Usage Tracking)

لتتبع استهلاك المستخدم، نقترح تضمين كائن متداخل داخل كل مستند مستخدم.

**`Users` -> `usage`**

| اسم العمود (Field) | نوع البيانات (Data Type) | الوصف                                         |
| :------------------ | :------------------------ | :-------------------------------------------- |
| **posts**           | `map`                     | يحتوي على `used` و `total` للمنشورات.        |
| **images**          | `map`                     | يحتوي على `used` و `total` للصور.            |
| **scripts**         | `map`                     | يحتوي على `used` و `total` لسكربتات الفيديو. |
| **agents**          | `map`                     | يحتوي على `used` و `total` للوكلاء.          |
| **lastResetDate**   | `timestamp`               | تاريخ آخر مرة تم فيها إعادة تعيين حصص الاستخدام. |

---

### 2. جدول `Drafts`

يحتوي هذا الجدول على المحتوى الذي يحفظه المستخدمون كمسودات.

| اسم العمود (Field) | نوع البيانات (Data Type) | الوصف                                                                         |
| :------------------ | :------------------------ | :----------------------------------------------------------------------------- |
| **draftId**         | `string`                  | **(المفتاح الأساسي)** مُعرّف فريد لكل مسودة.                                  |
| **userId**          | `string`                  | **(مفتاح أجنبي)** يربط المسودة بالمستخدم الذي أنشأها. (`Users.userId`)         |
| **type**            | `string`                  | نوع المسودة (`post`, `image`, `script`, `bot`).                                |
| **content**         | `any`                     | المحتوى الفعلي للمسودة (نص، كائن JSON، إلخ).                                   |
| **topic**           | `string`                  | الموضوع الأصلي الذي تم إنشاء المسودة بناءً عليه.                              |
| **createdAt**       | `timestamp`               | تاريخ ووقت حفظ المسودة.                                                      |

---

### 3. جدول `Subscriptions`

يحتوي هذا الجدول على تفاصيل اشتراكات المستخدمين.

| اسم العمود (Field) | نوع البيانات (Data Type) | الوصف                                                                            |
| :------------------ | :------------------------ | :-------------------------------------------------------------------------------- |
| **subscriptionId**  | `string`                  | **(المفتاح الأساسي)** مُعرّف فريد لكل اشتراك.                                    |
| **userId**          | `string`                  | **(مفتاح أجنبي)** يربط الاشتراك بالمستخدم. (`Users.userId`)                       |
| **planId**          | `string`                  | مُعرّف الخطة (`starter_plan`, `pro_monthly`, `pro_yearly`).                       |
| **status**          | `string`                  | حالة الاشتراك (`active`, `canceled`, `past_due`).                                 |
| **currentPeriodEnd**| `timestamp`               | تاريخ نهاية فترة الفوترة الحالية.                                               |
| **createdAt**       | `timestamp`               | تاريخ بدء الاشتراك.                                                             |

---

### 4. جدول `Payments`

يحتوي هذا الجدول على سجل بجميع معاملات الدفع.

| اسم العمود (Field) | نوع البيانات (Data Type) | الوصف                                                               |
| :------------------ | :------------------------ | :------------------------------------------------------------------- |
| **paymentId**       | `string`                  | **(المفتاح الأساسي)** مُعرّف فريد من بوابة الدفع.                  |
| **userId**          | `string`                  | **(مفتاح أجنبي)** يربط الدفعة بالمستخدم. (`Users.userId`)            |
| **subscriptionId**  | `string`                  | **(مفتاح أجنبي)** يربط الدفعة بالاشتراك. (`Subscriptions.subscriptionId`) |
| **amount**          | `number`                  | المبلغ المدفوع.                                                    |
| **currency**        | `string`                  | عملة الدفع (مثال: `USD`).                                          |
| **status**          | `string`                  | حالة الدفع (`succeeded`, `pending`, `failed`).                      |
| **createdAt**       | `timestamp`               | تاريخ ووقت تنفيذ عملية الدفع.                                      |

---

## العلاقات بين الجداول (Relationships)

-   **واحد-إلى-متعدد (One-to-Many):**
    -   مستخدم واحد (`Users`) يمكن أن يكون لديه العديد من المسودات (`Drafts`).
        -   `Drafts.userId` -> `Users.userId`
    -   مستخدم واحد (`Users`) يمكن أن يكون لديه العديد من سجلات الدفع (`Payments`).
        -   `Payments.userId` -> `Users.userId`

-   **واحد-إلى-واحد (One-to-One):**
    -   مستخدم واحد (`Users`) لديه اشتراك واحد (`Subscriptions`) فعال في أي وقت.
        -   `Subscriptions.userId` -> `Users.userId`
